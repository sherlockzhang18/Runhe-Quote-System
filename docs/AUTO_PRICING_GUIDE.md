# 自动定价功能使用指南

## 功能概述

自动定价系统能够根据您输入的工件规格信息，智能匹配价格库中的相应价格，为钻孔、攻螺纹、抠槽操作自动计算单价。

## 🚀 使用步骤

### 1. 填写基础信息

在创建报价单页面，首先填写以下关键信息：

**规格信息**
- 物料描述：ABS / 非ABS
- 管板材质：不锈钢 / 普通材质 / 09MnNiDⅢ  
- 年份：F25 / F26 / F27 / F28 (影响使用哪个价格列)
- 厚度：管板厚度

### 2. 填写加工信息

**钻孔信息**
- 钻孔孔径：孔的直径
- 钻孔孔数：需要钻孔的数量

**攻螺纹信息**
- 螺纹类别：螺纹盲孔 / 螺纹通孔
- 螺纹孔型号：螺纹规格
- 螺纹孔数：螺纹孔的数量
- 类别三：尖底 / 平底

**抠槽信息**
- 抠槽孔数：需要抠槽的数量

### 3. 一键自动获取价格

点击 **🚀 自动获取价格** 按钮，系统会：

1. 根据您填写的规格信息，在价格库中查找匹配的价格条目
2. 自动将找到的单价填入对应的价格字段
3. 实时计算并更新总价

## 💡 智能匹配规则

### 钻孔价格匹配
- 基于：物料描述 + 管板材质 + 厚度 + 孔径范围 + 孔数范围

### 攻螺纹价格匹配  
- 基于：螺纹类别 + 物料描述 + 孔径范围 + 类别三
- 特殊规则：
  - 如果物料描述为"ABS"，则需要匹配管板材质
  - 如果物料描述为"非ABS"，则不需要验证管板材质
  - 不考虑孔数范围限制

### 抠槽价格匹配
- 基于：物料描述 + 孔数范围

## 📊 价格计算公式

```
总价 = (钻孔单价 × 钻孔孔数) + (攻螺纹单价 × 螺纹孔数) + (抠槽单价 × 抠槽孔数)
```

## ⚡ 使用示例

### 示例1：不锈钢管板钻孔
```
物料描述: ABS
管板材质: 不锈钢  
厚度: 25
年份: F28
钻孔孔径: 12.5
钻孔孔数: 100
```

点击自动获取价格后，系统会查找价格库中：
- 类别一 = "钻孔"
- 类别二 = "ABS" 
- 材质 = "不锈钢"
- 厚度 = "25"
- 孔径在范围内 (12.5)
- 孔数在范围内 (100)

匹配成功后自动填入F28价格列的单价。

### 示例2：螺纹盲孔加工（非ABS材质）
```
物料描述: 非ABS
管板材质: 09MnNiDⅢ  // 这个字段在非ABS时不参与匹配
螺纹类别: 螺纹盲孔
螺纹孔型号: 16
螺纹孔数: 80  // 孔数不参与匹配范围检查
类别三: 尖底
年份: F27
```

系统会匹配：
- 类别一 = "螺纹盲孔"
- 类别二 = "非ABS"
- 类别三 = "尖底"  
- 孔径匹配 (16)
- 管板材质：跳过检查（因为是非ABS）
- 孔数：跳过范围检查

### 示例3：螺纹盲孔加工（ABS材质）
```
物料描述: ABS
管板材质: 不锈钢
螺纹类别: 螺纹盲孔
螺纹孔型号: 16
螺纹孔数: 80  // 孔数不参与匹配范围检查
类别三: 尖底
年份: F27
```

系统会匹配：
- 类别一 = "螺纹盲孔"
- 类别二 = "ABS"
- 类别三 = "尖底"
- 材质 = "不锈钢"（ABS材质需要验证管板材质）
- 孔径匹配 (16)
- 孔数：跳过范围检查

## 🔧 API接口

自动定价功能通过 `/api/quotes/price-match` 接口实现：

```javascript
POST /api/quotes/price-match
{
  "priceYear": "f28",
  "drillingParams": {
    "materialDescription": "ABS",
    "tubePlateMaterial": "不锈钢",
    "thickness": 25,
    "holeDiameter": 12.5,
    "holeCount": 100
  },
  "threadingParams": {
    "threadCategory": "螺纹盲孔",
    "materialDescription": "ABS", 
    "tubePlateMaterial": "不锈钢",  // ABS材质时需要验证管板材质
    "holeSpecification": 16,
    "category3": "尖底"
    // 注意：holeCount 已移除，不再检查孔数范围
  },
  "groovingParams": {
    "materialDescription": "ABS",
    "holeCount": 50
  }
}
```

返回：
```javascript
{
  "drillingPrice": "1.25",
  "threadingPrice": "2.80", 
  "groovingPrice": "0.95"
}
```

## ⚠️ 注意事项

1. **年份选择很重要**：不同年份对应不同的价格列(F25/F26/F27/F28)
2. **参数完整性**：填写的信息越完整，匹配的准确性越高
3. **手动调整**：自动获取的价格可以手动调整
4. **多次尝试**：如果没有匹配到价格，可以调整参数后重新尝试

## 🎯 优势特点

- **智能匹配**：基于多维度条件精确匹配价格
- **实时计算**：价格变动时总价自动更新
- **灵活调整**：支持手动修改自动获取的价格
- **历史追溯**：支持不同年份的价格查询
- **批量处理**：一次可获取多种工艺的价格

通过这个自动定价系统，您可以大大提高报价效率，减少手动查找价格的时间！
